= Protocol description

== Throw
  
=== 1. Anmelden / Peer Group erstellen
  
  POST        http://hoccer.com/peers
              {latitude=52.1&longitude=12.4&accuracy=100&gesture=pass&seeder=1}

  Response    200 OK
              JSON => {
                "peer_uri"    : "http://hoccer.com/peers/324234234234",
                "message"     : "Searching for partner",
                "upload_uri"  : "http://hoccer.com/uploads/213123123123"
              }
              
=== 2. Datei uploaden

  PUT         http://hoccer.com/uploads/213123123123
              {upload[attachment]=<FILE-Multipart>}
              
  Response    200 OK

=== 3. Polling nach Updates
  
  GET         http://hoccer.com/peers/324234234234
  Response    409 Collision || 202 Waiting || 500 No Peers/Seeders || 200 Ready
              JSON => {
                "state" : "collision || waiting || no_peers/no_seeders || ready",
                "message" : "like state but more verbose,"
                "expires" : 2 (seconds until the peer group expires),
                "resources" : [] (contains list of uploads if peer group expires with 200 Ready),
                "status_code" : 409 || 202 || 500 || 200
              }
            
== Catch

=== 1. Anmelden / Peer Group erstellen (omit seeder param)
  
  POST        http://hoccer.com/peers
              {latitude=52.1&longitude=12.4&accuracy=100&gesture=pass}
              
  Response    200 OK
              JSON => {
                "peer_uri"    : "http://hoccer.com/peers/558585858585",
                "message"     : "Searching for partner"
              }
              
=== 2. Polling nach Updates (Seeder und Peer)
  
  GET         http://hoccer.com/peers/558585858585
  
  Response    409 Collision || 202 Waiting || 500 No Peers/Seeders || 200 Ready
              JSON => {
                "state" : "collision || waiting || no_peers/no_seeders || ready",
                "message" : "like state but more verbose,"
                "expires" : 2 (seconds until the peer group expires),
                "resources" : [] (contains list of uploads if peer group expires with 200 Ready),
                "status_code" : 409 || 202 || 500 || 200
              }

= Deploying new versions of the server

To deploy your local version onto www.hoccer.com we have two rake tasks

1. to publish a new webpage (no server restart) 
 $ rake publish_web
 
2. to update the webservice (restart apache needed) 
 $ rake publish_service
 
 
= Server Setup =

The server has a post-receive hook (.git/hooks/post-receive) to update the
server automaticly after a push :

--------------8<-----------
#!/bin/sh

unset GIT_DIR
PROJECT_DIR=`pwd`/../

cd $PROJECT_DIR
git reset --hard
-------------->8-----------