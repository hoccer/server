<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />
<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAAiiDEYNktTfGWuTG7oMKXBRwfwpzNZdAfyOSdvkXWy6qchS0NxQ3cp1skZ71yopT8WdFxnPPGJhcEQ"
      type="text/javascript"></script>

<script src="javascripts/jquery-1-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="javascripts/swfobject.js" type="text/javascript" charset="utf-8"></script>
<script src="javascripts/jquery.uploadify.v2.0.1.min.js" type="text/javascript" charset="utf-8"></script>
      
      
      
<script type="text/javascript">
  function initialize() {
    if (GBrowserIsCompatible()) {
      mapContainer = document.getElementById("map_canvas");
      map = new GMap2(mapContainer);
      map.setCenter(new GLatLng(52.50094, 13.34566), 17);
      map.enableScrollWheelZoom();
    }
    
    setupScreen();
  };
  
  function setupScreen() {
    
    document.getElementById("latbox").value=map.getCenter().lat();
    document.getElementById("lonbox").value=map.getCenter().lng();
  
    logo = new GScreenOverlay('/images/rails.png',
            new GScreenPoint(10, .10, 'pixels', 'fraction'),  // screenXY
            new GScreenPoint(0, 0),  // overlayXY
            new GScreenSize(30, 40)  // size on screen
          );
    map.addOverlay(logo);
    
    
    GEvent.addListener(map, 'click', function(overlay, point) {
    
      if (point) {
        map.panTo(point);
      }
    });
    
    // Recenter Map and add Coords by clicking the map
    GEvent.addListener(map, 'click', function(overlay, point) {
                document.getElementById("latbox").value=point.y;
                document.getElementById("lonbox").value=point.x;
    });
    
    GEvent.addListener(map, 'dragend', function(){
      document.getElementById("latbox").value=map.getCenter().lat();
      document.getElementById("lonbox").value=map.getCenter().lng();
    });
    
    var mapControl = new GMapTypeControl();
    map.addControl(mapControl);
    map.addControl(new GLargeMapControl());
  }
  
  
</script>

<script type="text/javascript" charset="utf-8">

  $(document).ready(function(){
    
    /* Ajaxify the submit form */
    $("#submit").click(function(){      
      lat = $("#latbox").attr("value");
      lng = $("#lonbox").attr("value");
      
      lat = lat.toString().replace(/\./, ",");
      lng = lng.toString().replace(/\./, ",");
            
      if ($("input[value=upload]").attr("checked")) {
        $.ajax({
          type: "POST",
          url: "/locations/"+lat+";"+lng+";100,0/gestures",
          data: "name=distribute",
          success: function(msg){
            $("#upload_response").html(msg);
            path = msg.split("/")[4].replace(/\"\}/, "");
          
            $('#upload_foo').uploadify({
              'uploader':  '/uploadify.swf',
              'cancelImg': '/images/rails.png',
              'auto':      'true',
              'scriptData': {'_method' : 'put'}, 
              'script':    "/uploads/" + path
            });
          }
        });
      }
      else {
        alert("http://localhost/locations/"+lat+";"+lng+";100,0");
      
      
      }
      
      
      
      return false;
      
    });
  })
</script>
</head>
<body onload="initialize()">
  <div id="map_canvas" style="width: 600px; height: 450px"></div>
  
  <form action="#" method="get" accept-charset="utf-8">
    <p>
      <input type="radio" name="gesture_name" value="distribute" checked="checked"/> Distribute
      <input type="radio" name="gesture_name" value="pass" /> Pass
    </p>
    
    <p>
      <input type="radio" name="request_method" value="upload" checked="checked"/> Upload
      <input type="radio" name="request_method" value="download" /> Download
    </p>
      <p>Latitude: <input type="text" name="lat" id="latbox" value="1" /></p>
      <p>Longitude: <input type="text" name="long" id="lonbox" value="2" /></p>
    <input type="submit" id="submit" value="Go">
  </form>
  
  <p id="upload_response">
    
  </p>
  
  <div id="upload_foo">
   
  </div>
  
  <div id="results"></div>
</body>
</html>