<html>
<head>
<meta name="viewport" content="initial-scale=1.0, user-scalable=no" />

<style type="text/css" media="screen">
  body {
    text-align: center;
  }
  
  h1 {
    width: 600px;
    margin: 0 auto;
    text-align: left;
    font-size: 48pt;
    font-family: Verdana, Helvetica, Arial, sans-serif;
    letter-spacing: 5px;
    color: #95F2DB;
  }
  
  #wrapper {
    width: 600px;
    margin: 0 auto;
    text-align: left;
    padding: 10px;
    border: 2px dashed #000000;
  }
</style>

<script src="http://maps.google.com/maps?file=api&amp;v=2&amp;key=ABQIAAAAAiiDEYNktTfGWuTG7oMKXBRwfwpzNZdAfyOSdvkXWy6qchS0NxQ3cp1skZ71yopT8WdFxnPPGJhcEQ"
      type="text/javascript"></script>

<script src="javascripts/jquery-1-1.3.2.min.js" type="text/javascript" charset="utf-8"></script>
<script src="javascripts/swfobject.js" type="text/javascript" charset="utf-8"></script>
<script src="javascripts/jquery.uploadify.v2.0.1.min.js" type="text/javascript" charset="utf-8"></script>
      
<script type="text/javascript">
  function initialize() {
    if (GBrowserIsCompatible()) {
      mapContainer = document.getElementById("map_canvas");
      map = new GMap2(mapContainer);
      map.setCenter(new GLatLng(52.50094, 13.34566), 17);
      map.enableScrollWheelZoom();
    }
    
    setupScreen();
  };
  
  function setupScreen() {
    
    document.getElementById("latbox").value=map.getCenter().lat();
    document.getElementById("lonbox").value=map.getCenter().lng();
  
    setup_overlay();
    
    
    GEvent.addListener(map, 'click', function(overlay, point) {
    
      if (point) {
        map.panTo(point);
      }
    });
    
    GEvent.addListener(map, "zoomend", function() {
      setup_overlay();
    });
    
    
    // Recenter Map and add Coords by clicking the map
    GEvent.addListener(map, 'click', function(overlay, point) {
                document.getElementById("latbox").value=point.y;
                document.getElementById("lonbox").value=point.x;
    });
    
    GEvent.addListener(map, 'dragend', function(){
      document.getElementById("latbox").value=map.getCenter().lat();
      document.getElementById("lonbox").value=map.getCenter().lng();
    });
    
    var mapControl = new GMapTypeControl();
    map.addControl(mapControl);
    map.addControl(new GLargeMapControl());
  }
  
  
</script>

<script type="text/javascript" charset="utf-8">

  $(document).ready(function(){
    
    /* Ajaxify the submit form */
    $("#submit").click(function(){      
      lat = $("#latbox").attr("value");
      lng = $("#lonbox").attr("value");
      
      lat = lat.toString().replace(/\./, ",");
      lng = lng.toString().replace(/\./, ",");
            
      if ($("input[value=upload]").attr("checked")) {
        
        $("body").append("<div id='upload_foo'></div>");
        
        $.ajax({
          type: "POST",
          url: "/locations/"+lat+";"+lng+";100,0/gestures",
          data: "name=" + $('input[name=gesture_name]:checked').val(),
          success: function(msg){
            $("#upload_response").html(msg);
            path = msg.split("/")[4].replace(/\"\}/, "");
          
            $('#upload_foo').uploadify({
              'uploader':  '/uploadify.swf',
              'cancelImg': '/images/cancel.png',
              'fileDataName': 'upload[attachment]',
              'auto':      'true',
              'scriptData': {'_method' : 'put'}, 
              'script':    "/uploads/" + path,
              onAllComplete : function() {
                $("#upload_foo").remove();
              }
            });
          }
        });
      }
      else {
        alert("http://localhost/locations/"+lat+";"+lng+";100,0");
      
      
      }
      
      
      
      return false;
      
    });
  })
</script>

<script type="text/javascript" charset="utf-8">
  setup_overlay = function() {
    map.clearOverlays();
    
    var zoom_level      = map.getZoom();
    var max_zoom_level  = 17;
    var zoom_diff       = max_zoom_level - zoom_level;
    var scale_factor    = zoom_diff * 2;
    
    if (scale_factor == 0) {
      scale_factor = 1;
    }
    
    var radius_xy       = 300;
    
    var zoomed_radius_xy  = (radius_xy / scale_factor);
    var overlay_x         = (600-zoomed_radius_xy)/2;
    var overlay_y         = (450-zoomed_radius_xy)/2;
    
    logo = new GScreenOverlay('/images/radius.png',
            new GScreenPoint(overlay_x, overlay_y, 'pixels', 'pixels'),  // screenXY
            new GScreenPoint(0, 0),  // overlayXY
            new GScreenSize(zoomed_radius_xy, zoomed_radius_xy)  // size on screen
          );
    map.addOverlay(logo);
    
  }
</script>
</head>
<body onload="initialize()">
  
  <h1>
    hocca<img src="images/090728_hoccer_icon_01.png" width="48" height="48" alt="090728 Hoccer Icon 01" />
  </h1>
  <div id="wrapper">
    <div id="map_canvas" style="width: 600px; height: 450px"></div>
    
    <form action="#" method="get" accept-charset="utf-8">
      <p>
        <table>
          <tr>
            <td>
              <input type="radio" name="gesture_name" value="distribute" checked="checked"/> Distribute
            </td>
            <td>
              <input type="radio" name="gesture_name" value="pass" /> Pass
            </td>
          </tr>
          <tr>
            <td>
              <input type="radio" name="request_method" value="upload" checked="checked"/> Upload
            </td>
            <td>
              <input type="radio" name="request_method" value="download" /> Download
            </td>
          </tr>
          <tr>
            <td>Latitude:</td>
            <td><input type="text" name="lat" id="latbox" value="1" /></td>
          </tr>
          <tr>
            <td>Longitude:</td>
            <td><input type="text" name="long" id="lonbox" value="2" /</td>
          </tr>
          <tr>
            <td colspan="2" style="text-align: right">
              <input type="submit" id="submit" value="Go" />
            </td>
          </tr>
        </table>   
      </p>
    </form>
    
    <p id="upload_response">
      
    </p>
    
    <div id="results"></div>
  </div>
</body>
</html>