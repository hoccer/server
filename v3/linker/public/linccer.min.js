var HC={};HC.extend=function(c,b){for(var a in b){c[a]=b[a]}};HC.observable=function(a){var b={};a.on=function(d,e){if(b[d]===undefined){b[d]=[]}var c=b[d];if(typeof e==="function"){c.push(e)}};a.fire=function(d,f){var c=b[d]||[];for(var e in c){c[e](f)}};return a};HC.randomUUID=function(){var b=[],c="0123456789ABCDEF";for(var a=0;a<36;a++){b[a]=Math.floor(Math.random()*16)}b[14]=4;b[19]=(b[19]&3)|8;for(var a=0;a<36;a++){b[a]=c[b[a]]}b[8]=b[13]=b[18]=b[23]="-";return b.join("")};HC.each=function(d,h,c){var b,e=0,f=d.length,a=f===undefined;if(a){for(b in d){if(h.call(d[b],b,d[b])===false){break}}}else{for(var g=d[0];e<f&&h.call(g,e,g)!==false;g=d[++e]){}}return d};HC.isEmptyObject=function(b){for(var a in b){return false}return true};HC.type=function(a){return a==null?String(a):class2type[toString.call(a)]||"object"};HC.isArray=Array.isArray||function(a){return jQuery.type(a)==="array"};HC.param=function(b,d){var c=[],f=function(a,g){c[c.length]=encodeURIComponent(a)+"="+encodeURIComponent(g)};for(var e in b){buildParams(e,b[e],d,f)}return c.join("&").replace(/%20/g,"+")};function buildParams(b,d,a,c){if(HC.isArray(d)&&d.length){HC.each(d,function(f,e){if(a||rbracket.test(b)){c(b,e)}else{buildParams(b+"["+(typeof e==="object"||jQuery.isArray(e)?f:"")+"]",e,a,c)}})}else{if(!a&&d!=null&&typeof d==="object"){if(HC.isEmptyObject(d)){c(b,"")}else{HC.each(d,function(f,e){buildParams(b+"["+f+"]",e,a,c)})}}else{c(b,d)}}}var Linccer=function(k){var e={};HC.observable(e);var h,a,c,f;var g;var l={server:""};HC.extend(l,k);if(l.api_key===undefined){throw new Error("no api key provided")}e.uuid=HC.randomUUID();if(navigator.geolocation){navigator.geolocation.watchPosition(function(m){console.log(m.coords.latitude+" "+m.coords.longitude);e.setEnvironmentCoordinates(m.coords.latitude,m.coords.longitude,m.coords.accuracy,m.timestamp)},function(m){e.fire("error",m)},{maximumAge:Infinity})}var j=function(o,q){var n="jsonp"+Math.floor(Math.random()*10000000001);var p="http://linccer.beta.hoccer.com/v3/"+o+"&jsonp="+n;console.log(p);var m=document.createElement("script");m.setAttribute("type","text/javascript");m.setAttribute("src",p);document.body.appendChild(m);window[n]=function(r){if(q!==undefined&&e[q]!==undefined){e[q](r)}window[n]=undefined;document.body.removeChild(m)}};var d;var b=function(){clearTimeout(d);d=setTimeout(b,25*1000);if(h===undefined||a===undefined){return}j("/clients/"+e.uuid+"/environment.js?api_key="+l.api_key+"&latitude="+h+"&longitude="+a+"&accuracy="+c+"&timestamp="+f,"updatedEnvironment")};var i=function(m){if(m.message=="timeout"||m.message=="conflict"){e.fire("error",new Error(m.message));return true}return false};e.received=function(m){if(!i(m)){e.fire("received",m)}};e.sent=function(m){if(!i(m)){e.fire("sent",m)}};e.updatedEnvironment=function(m){if(!e.isReady()){g=true;e.fire("ready")}e.fire("updated_environment",m)};e.setEnvironmentCoordinates=function(m,p,q,o){h=m;a=p;c=q;if(o===undefined){var n=new Date();o=Math.round(n.getTime()/1000)}f=o;b()};e.send=function(o,m){var n={payload:m};j("/clients/"+e.uuid+"/action/send.js?mode="+o+"&"+HC.param(n),"sent")};e.receive=function(m){j("/clients/"+e.uuid+"/action/receive.js?mode="+m,"received")};e.isReady=function(){return g};return e};Linccer.autoLocation=function(){return(navigator.geolocation!==undefined)};