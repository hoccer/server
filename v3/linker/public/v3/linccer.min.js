var qq=qq||{};qq.extend=function(b,a){for(var c in a){b[c]=a[c]}};qq.indexOf=function(b,c,d){if(b.indexOf){return b.indexOf(c,d)}d=d||0;var a=b.length;if(d<0){d+=a}for(;d<a;d++){if(d in b&&b[d]===c){return d}}return -1};qq.obj2url=function(f,b,h){var g=[],d="&",e=function(k,j){var l=b?(/\[\]$/.test(b))?b:b+"["+j+"]":j;if((l!="undefined")&&(j!="undefined")){g.push((typeof k==="object")?qq.obj2url(k,l,true):(Object.prototype.toString.call(k)==="[object Function]")?encodeURIComponent(l)+"="+encodeURIComponent(k()):encodeURIComponent(l)+"="+encodeURIComponent(k))}};if(!h&&b){d=(/\?/.test(b))?(/\?$/.test(b))?"":"&":"?";g.push(b);g.push(qq.obj2url(f))}else{if((Object.prototype.toString.call(f)==="[object Array]")&&(typeof f!="undefined")){for(var c=0,a=f.length;c<a;++c){e(f[c],c)}}else{if((typeof f!="undefined")&&(f!==null)&&(typeof f==="object")){for(var c in f){e(f[c],c)}}else{g.push(encodeURIComponent(b)+"="+encodeURIComponent(f))}}}return g.join(d).replace(/^&/,"").replace(/%20/g,"+")};qq.UploadHandlerAbstract=function(a){this._options={debug:false,action:"/upload.php",maxConnections:999,onProgress:function(e,d,b,c){},onComplete:function(d,c,b){},onCancel:function(c,b){}};qq.extend(this._options,a);this._queue=[];this._params=[]};qq.UploadHandlerAbstract.prototype={log:function(a){if(this._options.debug&&window.console){console.log("[uploader] "+a)}},add:function(a){},upload:function(e,c,b){var a=this._queue.push(e);var d={};qq.extend(d,c);this._params[e]=d;if(a<=this._options.maxConnections){this._upload(e,this._params[e],b)}},cancel:function(a){this._cancel(a);this._dequeue(a)},cancelAll:function(){for(var a=0;a<this._queue.length;a++){this._cancel(this._queue[a])}this._queue=[]},getName:function(a){},getSize:function(a){},getQueue:function(){return this._queue},_upload:function(a){},_cancel:function(a){},_dequeue:function(d){var b=qq.indexOf(this._queue,d);this._queue.splice(b,1);var a=this._options.maxConnections;if(this._queue.length>=a){var c=this._queue[a-1];this._upload(c,this._params[c])}}};qq.UploadHandlerXhr=function(a){qq.UploadHandlerAbstract.apply(this,arguments);this._files=[];this._xhrs=[];this._loaded=[]};qq.UploadHandlerXhr.isSupported=function(){var a=document.createElement("input");a.type="file";return("multiple" in a&&typeof File!="undefined"&&typeof(new XMLHttpRequest()).upload!="undefined")};qq.extend(qq.UploadHandlerXhr.prototype,qq.UploadHandlerAbstract.prototype);qq.extend(qq.UploadHandlerXhr.prototype,{add:function(a){if(!(a instanceof File)){throw new Error("Passed obj in not a File (in qq.UploadHandlerXhr)")}return this._files.push(a)-1},getName:function(b){var a=this._files[b];return a.fileName!=null?a.fileName:a.name},getSize:function(b){var a=this._files[b];return a.fileSize!=null?a.fileSize:a.size},getLoaded:function(a){return this._loaded[a]||0},_upload:function(c,e,f){var d=this._files[c],b=this.getName(c),i=this.getSize(c);this._loaded[c]=0;var g=this._xhrs[c]=new XMLHttpRequest();var h=this;g.upload.onprogress=function(j){if(j.lengthComputable){h._loaded[c]=j.loaded;h._options.onProgress(c,b,j.loaded,j.total)}};g.onreadystatechange=function(){if(g.readyState==4){h._onComplete(c,g)}};e=e||{};var a=qq.obj2url(e,f||this._options.action);g.open(h._options.method,a,true);g.setRequestHeader("X-Requested-With","XMLHttpRequest");g.setRequestHeader("X-File-Name",encodeURIComponent(b));g.setRequestHeader("Content-Type",d.type||"application/octet-stream");g.setRequestHeader("Content-Disposition",'attachment; filename="'+b+'"');g.send(d)},_onComplete:function(id,xhr){if(!this._files[id]){return}var name=this.getName(id);var size=this.getSize(id);this._options.onProgress(id,name,size,size);if(xhr.status==200){this.log("xhr - server response received");this.log("responseText = "+xhr.responseText);var response;try{response=eval("("+xhr.responseText+")")}catch(err){response={}}this._options.onComplete(id,name,response)}else{this._options.onComplete(id,name,{})}this._files[id]=null;this._xhrs[id]=null;this._dequeue(id)},_cancel:function(a){this._options.onCancel(a,this.getName(a));this._files[a]=null;if(this._xhrs[a]){this._xhrs[a].abort();this._xhrs[a]=null}}});var FileCache=function(a){var b={};HC.observable(b);if(a.api_key===undefined){throw new Error("no api key provided")}var d,c;d=new qq.UploadHandlerXhr({method:"PUT",debug:true,onComplete:function(f,e){b.fire("loaded",e)},onProgress:function(h,g,e,f){b.fire("progress",e/f)}});b.cancel=function(){d.cancelAll();b.fire("canceled")};b.uploadURI=function(){return c};b.upload=function(e){c="https://filecache.hoccer.com/v3/"+HC.randomUUID();var f=d.add(e);d.upload(f,{expires_in:300,api_key:a.api_key},c);return{uri:c,type:e.type}};return b};var HC={};HC.extend=function(c,b){for(var a in b){c[a]=b[a]}};HC.observable=function(a){var b={};a.on=function(d,e){if(b[d]===undefined){b[d]=[]}var c=b[d];if(typeof e==="function"){c.push(e)}};a.fire=function(d,f){var c=b[d]||[];for(var e in c){c[e](f)}};return a};HC.randomUUID=function(){var b=[],c="0123456789ABCDEF";for(var a=0;a<36;a++){b[a]=Math.floor(Math.random()*16)}b[14]=4;b[19]=(b[19]&3)|8;for(var a=0;a<36;a++){b[a]=c[b[a]]}b[8]=b[13]=b[18]=b[23]="-";return b.join("")};HC.each=function(d,h,c){var b,e=0,f=d.length,a=f===undefined;if(a){for(b in d){if(h.call(d[b],b,d[b])===false){break}}}else{for(var g=d[0];e<f&&h.call(g,e,g)!==false;g=d[++e]){}}return d};HC.isEmptyObject=function(b){for(var a in b){return false}return true};HC.type=function(a){return a==null?String(a):class2type[toString.call(a)]||"object"};HC.isArray=Array.isArray||function(a){return jQuery.type(a)==="array"};HC.param=function(b,d){var c=[],f=function(a,g){c[c.length]=encodeURIComponent(a)+"="+encodeURIComponent(g)};for(var e in b){buildParams(e,b[e],d,f)}return c.join("&").replace(/%20/g,"+")};function buildParams(b,d,a,c){var e=/\[\]$/;if(HC.isArray(d)&&d.length){HC.each(d,function(g,f){if(a||e.test(b)){c(b,f)}else{buildParams(b+"["+(typeof f==="object"||jQuery.isArray(f)?g:"")+"]",f,a,c)}})}else{if(!a&&d!=null&&typeof d==="object"){if(HC.isEmptyObject(d)){c(b,"")}else{HC.each(d,function(g,f){buildParams(b+"["+g+"]",f,a,c)})}}else{c(b,d)}}};var json_parse=(function(){var d,b,a={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},m,k=function(n){throw {name:"SyntaxError",message:n,at:d,text:m}},g=function(n){if(n&&n!==b){k("Expected '"+n+"' instead of '"+b+"'")}b=m.charAt(d);d+=1;return b},f=function(){var o,n="";if(b==="-"){n="-";g("-")}while(b>="0"&&b<="9"){n+=b;g()}if(b==="."){n+=".";while(g()&&b>="0"&&b<="9"){n+=b}}if(b==="e"||b==="E"){n+=b;g();if(b==="-"||b==="+"){n+=b;g()}while(b>="0"&&b<="9"){n+=b;g()}}o=+n;if(isNaN(o)){k("Bad number")}else{return o}},h=function(){var q,p,o="",n;if(b==='"'){while(g()){if(b==='"'){g();return o}else{if(b==="\\"){g();if(b==="u"){n=0;for(p=0;p<4;p+=1){q=parseInt(g(),16);if(!isFinite(q)){break}n=n*16+q}o+=String.fromCharCode(n)}else{if(typeof a[b]==="string"){o+=a[b]}else{break}}}else{o+=b}}}}k("Bad string")},j=function(){while(b&&b<=" "){g()}},c=function(){switch(b){case"t":g("t");g("r");g("u");g("e");return true;case"f":g("f");g("a");g("l");g("s");g("e");return false;case"n":g("n");g("u");g("l");g("l");return null}k("Unexpected '"+b+"'")},l,i=function(){var n=[];if(b==="["){g("[");j();if(b==="]"){g("]");return n}while(b){n.push(l());j();if(b==="]"){g("]");return n}g(",");j()}}k("Bad array")},e=function(){var o,n={};if(b==="{"){g("{");j();if(b==="}"){g("}");return n}while(b){o=h();j();g(":");if(Object.hasOwnProperty.call(n,o)){k('Duplicate key "'+o+'"')}n[o]=l();j();if(b==="}"){g("}");return n}g(",");j()}}k("Bad object")};l=function(){j();switch(b){case"{":return e();case"[":return i();case'"':return h();case"-":return f();default:return b>="0"&&b<="9"?f():c()}};return function(q,o){var n;m=q;d=0;b=" ";n=l();j();if(b){k("Syntax error")}return typeof o==="function"?(function p(u,t){var s,r,w=u[t];if(w&&typeof w==="object"){for(s in w){if(Object.prototype.hasOwnProperty.call(w,s)){r=p(w,s);if(r!==undefined){w[s]=r}else{delete w[s]}}}}return o.call(u,t,w)}({"":n},"")):n}}());if(window.console===undefined){window.console={log:function(){},debug:function(){}}}var Linccer=function(n){var f={};HC.observable(f);var j,b,d,h;var i;var e;var p;var o={server:""};HC.extend(o,n);if(o.api_key===undefined){throw new Error("no api key provided")}o.server=(o.server===undefined||o.server==="production"||o.server==="")?"":"-"+o.server;var g=function(){var r="uuid=";var q=document.cookie.split(";");for(var s=0;s<q.length;s++){var t=q[s];while(t.charAt(0)==" "){t=t.substring(1,t.length)}if(t.indexOf(r)==0){return t.substring(r.length,t.length)}}return null};var m=function(q){document.cookie="uuid="+q;return};var a=g();if(a!=null){f.uuid=a}else{f.uuid=HC.randomUUID();m(f.uuid)}f.bssids=[];f.client_name="";f.selected_clients=[];if(navigator.geolocation){navigator.geolocation.watchPosition(function(q){f.setEnvironmentCoordinates(q.coords.latitude,q.coords.longitude,q.coords.accuracy,q.timestamp)},function(q){f.fire("error",q)},{maximumAge:Infinity,timeout:4000})}var l=function(s,u,r){var t="https://linccer"+o.server+".hoccer.com/v3"+s,q;console.log(t);q=new XMLHttpRequest();q.open("GET",t);q.onload=function(){if(u!==undefined&&f[u]!==undefined){if(q.status==401){f[u]({message:"not_authorized"})}else{if(q.status>399||q.status==204){f[u]({message:"request_timeout"})}else{f[u](json_parse(q.responseText))}}}};q.onerror=function(){f[u]({message:"request_timeout"})};q.send()};var c=function(){clearTimeout(e);e=setTimeout(c,25*1000);if(j===undefined||b===undefined){return}var r=[];for(var u=0;u<f.bssids.length;u++){if(f.bssids[u].trim()!==""){r.push("bssids[]="+f.bssids[u])}}var t="&"+r.join("&")||"";var q=[];for(var u=0;u<f.selected_clients.length;u++){if(f.selected_clients[u].trim()!==""){q.push("selected_clients[]="+f.selected_clients[u])}}var s="&"+q.join("&")||"";l("/clients/"+f.uuid+"/environment.js?api_key="+o.api_key+"&client_name="+f.client_name+s+"&latitude="+j+"&longitude="+b+"&accuracy="+d+t+"&timestamp="+h,"updatedEnvironment")};var k=function(q){if(q.message!==undefined){f.fire("error",new Error(q.message));return true}return false};f.received=function(q){if(!k(q)){f.fire("received",q)}};f.sent=function(q){if(!k(q)){f.fire("sent",q)}};f.peeked=function(q){if(!k(q)){f.fire("peeked",q)}};f.deletedClient=function(q){if(!k(q)){f.fire("deletedClient",q)}};f.updatedEnvironment=function(q){if(k(q)){return}if(!f.isReady()){i=true;f.fire("ready")}f.fire("updated_environment",q)};f.setEnvironmentCoordinates=function(q,t,u,s){j=q;b=t;d=u;if(s===undefined){var r=new Date();s=Math.round(r.getTime()/1000)}h=s;c()};f.setBssids=function(q){f.bssids=q;c()};f.setName=function(q){f.client_name=q;f.peek();c()};f.setClients=function(q){f.selected_clients=q;c()};f.send=function(s,q){var r={payload:q};l("/clients/"+f.uuid+"/action/send.js?api_key="+o.api_key+"&mode="+s+"&"+HC.param(r),"sent")};f.peek=function(q,r){l("/clients/"+f.uuid+"/action/peek.js?api_key="+o.api_key+"&group_id="+q,"peeked")};f.receive=function(u,s){if(s!==undefined){var r=s.timeout;delete s.timeout}var t=[];t.push("mode="+u);t.push("api_key="+o.api_key);if(s!==undefined){for(var q in s){t.push(q+"="+s[q])}}l("/clients/"+f.uuid+"/action/receive.js?"+t.join("&"),"received",r)};f.isReady=function(){return i};f.getID=function(){return f.uuid};f.deleteClient=function(q){if(!q){q=f.uuid}l("/clients/"+q+"/environment.js?api_key="+o.api_key+"&method=delete","deletedClient")};return f};Linccer.autoLocation=function(){return(navigator.geolocation!==undefined)};
