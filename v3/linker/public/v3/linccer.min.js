var Linccer=function(k){var e={};HC.observable(e);var h,a,c,f;var g;var l={server:""};HC.extend(l,k);if(l.api_key===undefined){throw new Error("no api key provided")}l.server=(l.server===undefined||l.server=="production")?".":"."+l.server+".";e.uuid=HC.randomUUID();if(navigator.geolocation){navigator.geolocation.watchPosition(function(m){e.setEnvironmentCoordinates(m.coords.latitude,m.coords.longitude,m.coords.accuracy,m.timestamp)},function(m){e.fire("error",m)},{maximumAge:Infinity,timeout:7000})}var j=function(o,q){var n="jsonp"+Math.floor(Math.random()*10000000001);var p="https://linccer"+l.server+"hoccer.com/v3"+o+"&jsonp="+n;var m=document.createElement("script");m.setAttribute("type","text/javascript");m.setAttribute("src",p);document.body.appendChild(m);window[n]=function(r){if(q!==undefined&&e[q]!==undefined){e[q](r)}window[n]=undefined;document.body.removeChild(m)}};var d;var b=function(){clearTimeout(d);d=setTimeout(b,25*1000);if(h===undefined||a===undefined){return}j("/clients/"+e.uuid+"/environment.js?api_key="+l.api_key+"&latitude="+h+"&longitude="+a+"&accuracy="+c+"&timestamp="+f,"updatedEnvironment")};var i=function(m){if(m.message=="timeout"||m.message=="conflict"){e.fire("error",new Error(m.message));return true}return false};e.received=function(m){if(!i(m)){e.fire("received",m)}};e.sent=function(m){if(!i(m)){e.fire("sent",m)}};e.updatedEnvironment=function(m){if(!e.isReady()){g=true;e.fire("ready")}e.fire("updated_environment",m)};e.setEnvironmentCoordinates=function(m,p,q,o){h=m;a=p;c=q;if(o===undefined){var n=new Date();o=Math.round(n.getTime()/1000)}f=o;b()};e.send=function(o,m){var n={payload:m};j("/clients/"+e.uuid+"/action/send.js?mode="+o+"&"+HC.param(n),"sent")};e.receive=function(m){j("/clients/"+e.uuid+"/action/receive.js?mode="+m,"received")};e.isReady=function(){return g};return e};Linccer.autoLocation=function(){return(navigator.geolocation!==undefined)};